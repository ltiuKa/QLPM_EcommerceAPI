<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Admin | E-Shop</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="/Frontend/assets/css/styles.css" rel="stylesheet">
</head>
<body>
	<div id="navbar"></div>
	<div class="container">
		<h3 class="mb-3">Admin Dashboard</h3>
		<div class="row">
			<div class="col-md-6">
				<h5>Sản phẩm</h5>
				<div class="mb-2">
					<input id="pName" class="form-control mb-1" placeholder="Tên sản phẩm"/>
					<input id="pShort" class="form-control mb-1" placeholder="Mô tả ngắn"/>
					<input id="pImage" class="form-control mb-1" placeholder="Ảnh chính (URL)"/>
					<button id="btnCreateP" class="btn btn-primary btn-sm">Tạo</button>
				</div>
				<div id="plist"></div>
			</div>
			<div class="col-md-6">
				<h5>Danh mục</h5>
				<div class="mb-2">
					<input id="cName" class="form-control mb-1" placeholder="Tên danh mục"/>
					<button id="btnCreateC" class="btn btn-primary btn-sm">Tạo</button>
				</div>
				<div id="clist"></div>
			</div>
		</div>
		<hr/>
		<h5>Upload ảnh sản phẩm</h5>
		<div class="row g-2">
			<div class="col-md-4"><input id="uProductId" class="form-control" placeholder="Product Id"/></div>
			<div class="col-md-4"><input id="uFile" type="file" class="form-control"/></div>
			<div class="col-md-2"><div class="form-check mt-2"><input id="uIsMain" class="form-check-input" type="checkbox"/> <label class="form-check-label">Ảnh chính</label></div></div>
			<div class="col-md-2"><button id="btnUpload" class="btn btn-secondary w-100">Upload</button></div>
		</div>
	</div>

	<script>window.USE_HTTP = true;</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script type="module">
		async function loadPartial(id, url){ const html = await (await fetch(url)).text(); document.getElementById(id).innerHTML = html; }
		await loadPartial('navbar','/Frontend/partials/navbar.html');
		import { ProductAPI, AdminAPI } from '/Frontend/assets/js/api.js';
		async function refresh(){
			const ps = await ProductAPI.list('');
			document.getElementById('plist').innerHTML = ps.map(p=>`<div class=\"card p-2 mb-2\">${p.name}<div class=\"mt-1\"><button class=\"btn btn-sm btn-outline-danger\" data-id=\"${p.id}\">Xóa</button></div></div>`).join('');
			Array.from(document.querySelectorAll('#plist button')).forEach(b=> b.onclick = async()=>{ await AdminAPI.deleteProduct(b.dataset.id); refresh(); });
		}
		document.getElementById('btnCreateP').onclick = async()=>{
			await AdminAPI.createProduct({ name: document.getElementById('pName').value, shortDescription: document.getElementById('pShort').value, mainImageUrl: document.getElementById('pImage').value });
			refresh();
		};
		document.getElementById('btnCreateC').onclick = async()=>{
			await AdminAPI.createCategory({ name: document.getElementById('cName').value });
			alert('Đã tạo danh mục');
		};
		refresh();
		document.getElementById('btnUpload').onclick = async()=>{
			const id = document.getElementById('uProductId').value.trim();
			const file = document.getElementById('uFile').files[0];
			const isMain = document.getElementById('uIsMain').checked;
			if (!id || !file) { alert('Nhập Product Id và chọn file'); return; }
			await AdminAPI.uploadProductImage(id, file, isMain);
			alert('Đã upload');
		};
	</script>
</body>
</html>

