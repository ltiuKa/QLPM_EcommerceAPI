<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>E-Shop | Chi tiết sản phẩm</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="/Frontend/assets/css/styles.css" rel="stylesheet">
</head>
<body>
	<div id="navbar"></div>
	<div class="container" id="content"></div>

	<script>window.USE_HTTP = true;</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script type="module">
		async function loadPartial(id, url){ const html = await (await fetch(url)).text(); document.getElementById(id).innerHTML = html; }
		await loadPartial('navbar','/Frontend/partials/navbar.html');
		import { ProductAPI, CartAPI } from '/Frontend/assets/js/api.js';
		const params = new URLSearchParams(location.search);
		const id = params.get('id');
		const p = await ProductAPI.get(id);
		const v = (p.variants && p.variants.length>0) ? p.variants[0] : null;
		const box = document.getElementById('content');
		box.innerHTML = `
			<div class="row">
				<div class="col-md-6">${p.mainImageUrl ? `<img src="${p.mainImageUrl}" class="img-fluid"/>` : ''}</div>
				<div class="col-md-6">
					<h3>${p.name}</h3>
					<p>${p.shortDescription || ''}</p>
					<div class="d-flex gap-2">
						<button class="btn btn-primary" id="btnAdd">Thêm vào giỏ</button>
						<a class="btn btn-outline-secondary" href="/Frontend/cart.html">Xem giỏ</a>
					</div>
				</div>
			</div>`;
		document.getElementById('btnAdd').onclick = async()=>{
			await CartAPI.add({ productId: p.id, productVariantId: v? v.id:null, quantity:1, unitPrice: v? (v.basePrice||0):0 });
			alert('Đã thêm vào giỏ');
		};
	</script>
</body>
</html>

