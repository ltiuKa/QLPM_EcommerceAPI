<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>E-Shop | Giỏ hàng</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="/Frontend/assets/css/styles.css" rel="stylesheet">
</head>
<body>
	<div id="navbar"></div>
	<div class="container">
		<h2 class="mb-3">Giỏ hàng</h2>
		<div id="cart"></div>
		<div class="mt-3">
			<input id="ship" class="form-control" placeholder="Địa chỉ giao hàng"/>
			<button id="btnCheckout" class="btn btn-primary mt-2">Tạo đơn từ giỏ</button>
		</div>
	</div>

	<script>window.USE_HTTP = true;</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script type="module">
		async function loadPartial(id, url){ const html = await (await fetch(url)).text(); document.getElementById(id).innerHTML = html; }
		await loadPartial('navbar','/Frontend/partials/navbar.html');
		import { CartAPI, OrderAPI } from '/Frontend/assets/js/api.js';
		const cartEl = document.getElementById('cart');
		async function render(){
			const cart = await CartAPI.get();
			let total = 0;
			const html = (cart.items||[]).map(i=>{ total += i.quantity*i.unitPrice; return `<li class="list-group-item d-flex justify-content-between">${i.productId} x ${i.quantity}<span>${(i.quantity*i.unitPrice).toLocaleString()}</span></li>`;}).join('');
			cartEl.innerHTML = `<ul class="list-group">${html||'<li class=\"list-group-item\">Trống</li>'}</ul><div class="mt-2">Tổng: <b>${total.toLocaleString()} VND</b></div>`;
		}
		document.getElementById('btnCheckout').onclick = async()=>{
			const addr = (document.getElementById('ship').value || 'Địa chỉ demo');
			await OrderAPI.checkoutFromCart(addr);
			alert('Đã tạo đơn');
			render();
		};
		render();
	</script>
</body>
</html>

